{{- define "main" -}}
<div class="search-page">
    <header class="search-header">
        <h1 class="search-title">{{ .Title }}</h1>
    </header>
    
    <div class="search-input-wrapper">
        <input type="text" id="searchInput" placeholder="Search..." autocomplete="off" />
        <button id="searchButton">üîéÔ∏é</button>
    </div>
    
    <div id="finalResults" class="search-results"></div>
    <div id="searchResults" style="display: none;"></div>
</div>

<style>
    .search-page { max-width: 800px; margin: 0 auto; padding: 2rem; }
    .search-input-wrapper { display: flex; gap: 0.5rem; margin-bottom: 3rem; }
    #searchInput { flex: 1; padding: 1rem; font-size: 1.1rem; border: 1px solid var(--border); border-radius: 4px; background: var(--code-bg); color: var(--primary); }
    #searchButton { padding: 1rem 1.5rem; background: var(--primary); color: var(--theme); border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
    .res-list { list-style: none; padding: 0; margin: 0; }
    .res-item { margin-bottom: 1.5rem; padding: 1.5rem; border: 1px solid var(--border); border-radius: 8px; background: var(--entry); }
    .res-item a { color: var(--primary) !important; text-decoration: none; font-size: 1.3rem; font-weight: 700; display: block; margin-bottom: 0.8rem; }
    .res-item .res-desc { color: var(--secondary) !important; font-size: 0.95rem; line-height: 1.6; }
</style>

<script src="{{ "js/search.min.js" | absURL }}"></script>

<script>
    window.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        const searchResults = document.getElementById('searchResults');
        const finalResults = document.getElementById('finalResults');

        function performSearch() {
            const query = searchInput.value.trim().toLowerCase();
            if (query.length === 0) {
                finalResults.innerHTML = '';
                return;
            }

            finalResults.innerHTML = '<p style="text-align:center;">Searching...</p>';

            setTimeout(() => {
                const rawItems = searchResults.querySelectorAll('li, .list-entry, .entry-item, article');
                const seenLinks = new Set();
                let html = '<ul class="res-list">';
                let foundCount = 0;

                rawItems.forEach(item => {
                    const linkEl = item.querySelector('a');
                    if (!linkEl) return;
                    
                    const link = linkEl.href.toLowerCase();
                    if (seenLinks.has(link)) return;

                    const titleEl = item.querySelector('h1, h2, h3, .entry-header, .entry-title, .search-result-title');
                    const title = (titleEl ? titleEl.innerText : linkEl.innerText).trim();
                    const descEl = item.querySelector('.entry-content, .entry-summary, .res-desc, p');
                    const desc = descEl ? descEl.innerText.trim() : "";

                    // [ÌïµÏã¨ ÌïÑÌÑ∞ÎßÅ Î°úÏßÅ]
                    const inTitle = title.toLowerCase().includes(query);
                    const inDesc = desc.toLowerCase().includes(query);
                    const isNumeric = /^\d+$/.test(query);
                    const isHanja = /[\u4E00-\u9FFF]/.test(query); // ÌïúÏûê Ï≤¥ÌÅ¨
                    
                    // ÎÇ†Ïßú Ï†ïÎ≥¥(2025, 2026, 02, 08 Îì±)ÏôÄ Í≤πÏπòÎäî ÎÇöÏãúÏÑ± Ïà´Ïûê Î™©Î°ù
                    const commonDateParts = ["2025", "2026", "02", "08", "20", "25", "26", "1", "2"];

                    let shouldShow = false;

                    if (inTitle || inDesc) {
                        // Ï†úÎ™©Ïù¥ÎÇò ÏöîÏïΩÎ¨∏Ïóê Îã®Ïñ¥Í∞Ä Î≥¥Ïù¥Î©¥ Î¨¥Ï°∞Í±¥ ÌÜµÍ≥º
                        shouldShow = true;
                    } else if (isHanja) {
                        // "Âúã"Í≥º Í∞ôÏùÄ ÌïúÏûêÎäî ÏöîÏïΩÎ¨∏Ïóê Ïïà Î≥¥Ïó¨ÎèÑ ÏóîÏßÑÏù¥ Ï∞æÏïÑÏôîÎã§Î©¥ Î≥∏Î¨∏Ïóê ÏûàÎäî Í≤ÉÏù¥ÎØÄÎ°ú ÌÜµÍ≥º
                        shouldShow = true;
                    } else if (isNumeric && !commonDateParts.includes(query)) {
                        // "4", "6", "8" Ï≤òÎüº ÎÇ†Ïßú ÏÑ±Î∂ÑÏù¥ ÏïÑÎãå Ïà´ÏûêÎäî Î≥∏Î¨∏ ÎÇ¥Ïö©ÏúºÎ°ú Í∞ÑÏ£ºÌïòÏó¨ ÌÜµÍ≥º
                        shouldShow = true;
                    } else if (!isNumeric && query.length >= 2 && !/^[a-z]{1,2}$/i.test(query)) {
                        // ÌïúÍ∏Ä Îã®Ïñ¥(ÏÑ±Ï°∞, Ï°∞Î•ò Îì±)Îäî Î≥∏Î¨∏ Í≤ÄÏÉâ Î≥¥Ïû•ÏùÑ ÏúÑÌï¥ ÌÜµÍ≥º
                        shouldShow = true;
                    }

                    if (shouldShow) {
                        seenLinks.add(link);
                        html += `
                            <li class="res-item">
                                <a href="${link}">${title}</a>
                                <div class="res-desc">${desc || 'The content contains the search term.'}</div>
                            </li>`;
                        foundCount++;
                    }
                });

                html += '</ul>';
                finalResults.innerHTML = foundCount > 0 ? html : '<p style="text-align:center;">No results found.</p>';
                searchResults.innerHTML = '';
            }, 300);
        }

        searchInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') performSearch(); });
        searchButton.addEventListener('click', performSearch);
        searchInput.addEventListener('input', () => { if (searchInput.value.trim() === '') finalResults.innerHTML = ''; });
    });
</script>
{{- end -}}